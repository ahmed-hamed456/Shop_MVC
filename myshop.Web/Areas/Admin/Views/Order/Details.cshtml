@model OrderVM
@using myshop.Utilities
@{

    ViewBag.pageTitle = "Orders Management";
    ViewBag.CardTitle = "View Order Details";
}


<form method="post">
    <div class="container">
        <div>
        <div class="container rounded p-2">
            <div class="row">
            <div class="col-12 col-lg-15 pb-4">
        <div class="row">
            <h4 class="d-flex justify-content-between align-items-center mb-3">
                <span>PickUp Details</span>
            </h4>
        </div>
    <input asp-for="OrderHeader.Id" hidden  />
    <div class="mb-3">
        <label  class="form-label">Name</label>
            <input type="text" class="form-control" asp-for="OrderHeader.Name" >
            <span asp-validation-for="OrderHeader.Name" class="text-danger"></span>
    </div>
        <div class="mb-3">
            <label  class="form-label">Phone Number</label>
            <input type="text" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" asp-for="OrderHeader.PhoneNumber" >
            <span asp-validation-for="OrderHeader.PhoneNumber" class="text-danger"></span>
            </div>
        <div class="mb-3">
            <label for="exampleInputEmail1" class="form-label">Address</label>
            <input type="text" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" asp-for="OrderHeader.Address">
             <span asp-validation-for="OrderHeader.Address" class="text-danger"></span>
            </div>
        <div class="mb-3">
            <label for="exampleInputEmail1" class="form-label">City</label>
            <input type="text" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" asp-for="OrderHeader.City">
            <span asp-validation-for="OrderHeader.City" class="text-danger"></span>
        </div>
        <div class="mb-3">
            <label for="exampleInputEmail1" class="form-label">Email address</label>
            <input type="text" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" asp-for="OrderHeader.ApplicationUser.Email" readonly>
            
        </div>
        <div class="mb-3">
            <label for="exampleInputEmail1" class="form-label">Order Date</label>
       
            <input type="text" value="@Model.OrderHeader.OrderDate.ToShortDateString()" class="form-control" id="exampleInputEmail1" readonly aria-describedby="emailHelp">
           
        <div class="mb-3">
            <label for="exampleInputEmail1" class="form-label">Carrier</label>
                    <input type="text" class="form-control" aria-describedby="emailHelp" asp-for="OrderHeader.Carrier" id="carrier">
                </div>
            <div class="mb-3">
                <label for="exampleInputEmail1" class="form-label">TrackingNumber</label>
                    <input type="text" class="form-control" aria-describedby="emailHelp" asp-action="orderHeader.TrackingNumber" id="tracking">
            </div>
            <div class="mb-3">
                <label for="exampleInputEmail1" class="form-label">ShippingDate</label>
                <input type="text" class="form-control" value="@Model.OrderHeader.ShippingDate.ToShortDateString()" id="exampleInputEmail1" aria-describedby="emailHelp">
            </div>
            <div class="mb-3">
                <label for="exampleInputEmail1" class="form-label">Session Id</label>
                <input type="text" class="form-control" readonly id="exampleInputEmail1" aria-describedby="emailHelp" asp-for="OrderHeader.SessionId">
            </div>
        <div class="mb-3">
                <div class="mb-3">
                    <label for="exampleInputEmail1" class="form-label">PaymentId</label>
                    <input type="text" class="form-control" readonly id="exampleInputEmail1" aria-describedby="emailHelp" asp-for="OrderHeader.PaymentIntentId">
                </div>
                <div class="mb-3">
                    <label for="exampleInputEmail1" class="form-label">PaymentDate </label>
                    <input type="text" class="form-control" value="@Model.OrderHeader.PaymentDate.ToShortDateString()" id="exampleInputEmail1" aria-describedby="emailHelp">
                </div>
        </div>

        <div class="container" style="margin:10px">
            <button type="submit" class="btn btn-secondary" asp-action="UpdateOrderDetails" >Update PickUp Details</button> 
        </div>

<div class="container">
<div class="col-md-4">
    <div class="card mb-4">
        <div class="card-header py-3">
                <label class="btn btn-outline-primary form-control my-2">OrderStatus : @Model.OrderHeader.OrderStatus </label>
         
        </div>
        <div class="card-body">
            <ul class="list-group mb-3">
                    @foreach (var item in Model.OrderDetails){
                <li class="list-group-item d-flex justify-content-between p-2">
                    <div class="row container">
                        <div class="col-8">
                            <h6 class="my-0 text-primary">@item.Product.Name</h6>
                            <small class="text-muted">Price : @item.Product.Price</small><br />
                            <small class="text-muted">Quantity : @item.Count</small>
                        </div>
                        <div class="col-4 text-end">
                            <p class="text-success">@((item.Count * item.Price).ToString("c"))</p>
                        </div>
                    </div>
                </li>
                    }
                <li class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 mb-3">
                    <div>
                            <strong>Total_Price</strong>
                        <strong>
                            <p class="mb-0">(including VAT)</p>
                        </strong>
                    </div>
                        <span><strong>@Model.OrderHeader.TotalPrice.ToString("c")</strong></span>
                </li>
            </ul>


        </div>
    </div>
</div>
</div>

    @if ( Model.OrderHeader.OrderStatus == SD.Approve) {

        <button type="submit" class="btn btn-primary" asp-action="StartProccess" > Start Processing </button>

    }

    @if (Model.OrderHeader.OrderStatus == SD.Proccessing)
    {

    <input type="submit" class="btn btn-success" asp-action="StartShip" onclick="return CheckData()" value="start shipping"/>
      
    }

    @if (Model.OrderHeader.OrderStatus != SD.Cancelled || Model.OrderHeader.OrderStatus != SD.Refund)
    {
        <button type="submit" class="btn btn-danger" asp-action="CancelOrder"> Cancel Order </button>
    }
                </div>
            </div>
        </div>
    </div>
  </div>
</form>



@section Scripts{
    <script> 
        function CheckData() {
            if (document.getElementById("carrier").value == '') {
                Swal.fire({
                    title: "There is an error",
                    text: "Please Enter Carrier",
                    icon: "error",
                    confirmButtonColor: "#3085d5",
                    cancelButtonColor: "#d33",
                });
                return false;
            }
                if (document.getElementById("tracking").value == '') {
                    Swal.fire({
                        title: "there is an error",
                        text: "please Enter Tracking Number",
                        icon: "error",
                        confirmButtonColor: "#3085d5",
                        cancelButtonColor: "#d33",
                    });
                    return false;
                }
            return true;
        }
    </script>
}